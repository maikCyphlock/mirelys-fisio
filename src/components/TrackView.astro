---
import { Redis } from "@upstash/redis"
const country  = Astro.request.headers.get('X-Vercel-IP-Country')
const ip = Astro.request.headers.get('x-real-ip') || Astro.request.headers.get('x-forwarded-for');

const redis =  new Redis({
    url: import.meta.env.UPSTASH_REDIS_REST_URL,
    token: import.meta.env.UPSTASH_REDIS_REST_TOKEN
} )

const saveViewCount = async () => {
     
       if(ip !== await redis.get('ip:' + ip)){
        await redis.set('ip:' + ip, country)
        const count = await redis.incr('views:' + country)
       }
      
}
await saveViewCount()
---